/*! For license information please see 05017529.9d87217c.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{131:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return l})),n.d(t,"metadata",(function(){return u})),n.d(t,"rightToc",(function(){return b})),n.d(t,"default",(function(){return m}));var r=n(1),a=n(9),o=(n(0),n(269)),i=n(271),c=n(277),s=n(278),l={id:"webhook",title:"Webhook Node",sidebar_label:"Webhook Node"},u={id:"convai-studio/nodes/stock/webhook",title:"Webhook Node",description:"import useBaseUrl from '@docusaurus/useBaseUrl';",source:"@site/docs/convai-studio/nodes/stock/webhook.mdx",permalink:"/convai-studio/nodes/stock/webhook",sidebar_label:"Webhook Node",sidebar:"someSidebar",previous:{title:"Set Data Node",permalink:"/convai-studio/nodes/stock/set-data"},next:{title:"NLP Node",permalink:"/convai-studio/nodes/nlp/nlp"}},b=[{value:"Usage",id:"usage",children:[]},{value:"Steps",id:"steps",children:[]},{value:"NodeJS Example",id:"nodejs-example",children:[]},{value:"Go Example",id:"go-example",children:[]}],p={rightToc:b};function m(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h2",{id:"usage"},"Usage"),Object(o.b)("p",null,"The webhook node is used to send a POST request to a URL. The webhook node sends the current execution data along with the user data and expects back a ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"../../node-sdk/classes/context-modifier.mdx"}),"ContextModifier")," Object to do any changes in the context. Usually we use the custom Webhook along with ",Object(o.b)("strong",{parentName:"p"},"Convai ",Object(o.b)("a",Object(r.a)({parentName:"strong"},{href:"/node-sdk/introduction"}),"NodeJS SDK"),"/ ",Object(o.b)("a",Object(r.a)({parentName:"strong"},{href:"/go-sdk/introduction"}),"Go SDK"))),Object(o.b)("h2",{id:"steps"},"Steps"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Setup your webhook url. You can directly input it in the webhook node. You can add it as an environment variable and then access it using ",Object(o.b)("inlineCode",{parentName:"p"},"{{env.WEBHOOK_URL}}"),"."),Object(o.b)("img",{alt:"Setup Webhook",src:Object(i.a)("img/nodes/stock/webhook/image1.png")})),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Setup your webhook node. The Value Field is ",Object(o.b)("strong",{parentName:"p"},Object(o.b)("a",Object(r.a)({parentName:"strong"},{href:"/convai-studio/concepts#configuration-templator"}),"Configuration Templator")),". So here I am accessing my webhookUrl using ",Object(o.b)("inlineCode",{parentName:"p"},"{{env.WEBHOOK_URL}}")),Object(o.b)("img",{alt:"Setup Webhook",src:Object(i.a)("img/nodes/stock/webhook/image2.png")})),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Send the context change back in the response. The response needs to be in a certain format as shown in the following code. If you don't want to do any code change, you can just send an empty object back as the response."))),Object(o.b)("h2",{id:"nodejs-example"},"NodeJS Example"),Object(o.b)(c.a,{defaultValue:"withoutSdk",values:[{label:"Without SDK",value:"withoutSdk"},{label:"With SDK",value:"withSdk"}],mdxType:"Tabs"},Object(o.b)(s.a,{value:"withoutSdk",mdxType:"TabItem"},Object(o.b)("p",null,"You can read more about ",Object(o.b)("strong",{parentName:"p"},Object(o.b)("a",Object(r.a)({parentName:"strong"},{href:"/node-sdk/models/context-change"}),"Change object")),", ",Object(o.b)("strong",{parentName:"p"},Object(o.b)("a",Object(r.a)({parentName:"strong"},{href:"/node-sdk/models/log-entry"}),"Log Entry"))," and ",Object(o.b)("strong",{parentName:"p"},Object(o.b)("a",Object(r.a)({parentName:"strong"},{href:"/node-sdk/models/error"}),"Error object"))),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"// In our example, we are setting a firstName and lastName for the user as John\n// and Snow respectively. Optionally, we are also logging in Convai that we\n// have changed the firstName\n\napp.post('/verifyByEmail', (req, res, next) => {\n\n    res.json({\n        changes: [\n            {\n                type: 2,\n                op: 0,\n                key: 'firstName',\n                data: 'John'\n            }, {\n                type: 2,\n                op: 0,\n                key: 'lastName',\n                data: 'Snow'\n            }\n        ],\n        logs: [\n            {\n                level: 10,\n                message: 'Changed firstName to John',\n                time: new Date()\n            }\n        ],\n        errors: []\n    });\n    \n})\n"))),Object(o.b)(s.a,{value:"withSdk",mdxType:"TabItem"},Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"const {ContextModifier} = require('convai-sdk')\n\n// In our example, we are setting a firstName and lastName for the user as John\n// and Snow respectively. Optionally, we are also logging in Convai that we\n// have changed the firstName\n\napp.post('/verifyByEmail', (req, res, next) => {\n    let cm = new ContextModifier();\n\n    cm.setUser('firstName', 'John');\n    cm.setUser('lastName', 'Snow');\n    cm.logInfo('Changed firstName to John');\n\n    res.json(cm);\n})\n")))),Object(o.b)("h2",{id:"go-example"},"Go Example"),Object(o.b)("p",null,"Refer to the Go SDK ",Object(o.b)("strong",{parentName:"p"},Object(o.b)("a",Object(r.a)({parentName:"strong"},{href:"/go-sdk/methods/webhook"}),"Webhook"))," page for more information. We use ",Object(o.b)("strong",{parentName:"p"},Object(o.b)("a",Object(r.a)({parentName:"strong"},{href:"https://github.com/gin-gonic/gin#gin-web-framework"}),"Gin Web Framework"))," in this example as the HTTP web framework."),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-go"}),'// In our example, we are setting a firstName and lastName for the user as John\n// and Snow respectively. Optionally, we are also logging in Convai that we\n// have changed the firstName\n\npackage main\n\nimport (\n    "fmt"\n    "net/http"\n    "os"\n\n    "github.com/datomar-labs-inc/convai-sdk-go"\n    "github.com/gin-gonic/gin"\n)\n\nfunc main() {\n    r := gin.Default()\n    wm := convai.NewWebhookManager()\n    \n    wm.Handle("verifyByEmail", func(name string, ctx *convai.RequestContext, cm *convai.ContextModifier) error {\n        cm.SetUser("firstName","John")\n        cm.SetUser("lastName","Snow")\n        cm.LogInfo("Change name to John Snow")\n        return nil\n    })\n    \n    wm.Catch(func(name string, ctx *convai.RequestContext, cm *convai.ContextModifier) error {\n        fmt.Println("UNHANDLED", name)\n        return nil\n    })\n\n    r.POST("/", func(c *gin.Context) {\n        var req convai.WebhookRequest\n\n        err := c.ShouldBindJSON(&req)\n        if err != nil {\n            c.JSON(http.StatusBadRequest, err)\n            return\n        }\n\n        cm, err:= wm.Process(&req)\n        if err != nil {\n            c.JSON(http.StatusInternalServerError, gin.H{"error": err.Error()})\n            return\n        }\n\n        c.JSON(http.StatusOK, cm)\n    })\n    \n    port := "8081"\n    r.Run(fmt.Sprintf(":%s", port))\n}\n')))}m.isMDXComponent=!0},269:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return d}));var r=n(0),a=n.n(r);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=a.a.createContext({}),u=function(e){var t=a.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):c({},t,{},e)),n},b=function(e){var t=u(e.components);return a.a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},m=Object(r.forwardRef)((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),b=u(n),m=r,d=b["".concat(i,".").concat(m)]||b[m]||p[m]||o;return n?a.a.createElement(d,c({ref:t},l,{components:n})):a.a.createElement(d,c({ref:t},l))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=m;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:r,i[1]=c;for(var l=2;l<o;l++)i[l]=n[l];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},270:function(e,t,n){"use strict";var r=n(0),a=n(49);t.a=function(){return Object(r.useContext)(a.a)}},271:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));n(272);var r=n(270);function a(e){var t=(Object(r.a)().siteConfig||{}).baseUrl,n=void 0===t?"/":t;if(!e)return e;return/^(https?:|\/\/)/.test(e)?e:e.startsWith("/")?n+e.slice(1):n+e}},272:function(e,t,n){"use strict";var r=n(12),a=n(24),o=n(273),i="".startsWith;r(r.P+r.F*n(274)("startsWith"),"String",{startsWith:function(e){var t=o(this,e,"startsWith"),n=a(Math.min(arguments.length>1?arguments[1]:void 0,t.length)),r=String(e);return i?i.call(t,r,n):t.slice(n,n+r.length)===r}})},273:function(e,t,n){var r=n(73),a=n(25);e.exports=function(e,t,n){if(r(t))throw TypeError("String#"+n+" doesn't accept regex!");return String(a(e))}},274:function(e,t,n){var r=n(2)("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[r]=!1,!"/./"[e](t)}catch(a){}}return!0}},275:function(e,t,n){var r;!function(){"use strict";var n={}.hasOwnProperty;function a(){for(var e=[],t=0;t<arguments.length;t++){var r=arguments[t];if(r){var o=typeof r;if("string"===o||"number"===o)e.push(r);else if(Array.isArray(r)&&r.length){var i=a.apply(null,r);i&&e.push(i)}else if("object"===o)for(var c in r)n.call(r,c)&&r[c]&&e.push(c)}}return e.join(" ")}e.exports?(a.default=a,e.exports=a):void 0===(r=function(){return a}.apply(t,[]))||(e.exports=r)}()},277:function(e,t,n){"use strict";n(26),n(19),n(20);var r=n(0),a=n.n(r),o=n(275),i=n.n(o),c=n(124),s=n.n(c),l=37,u=39;t.a=function(e){var t=e.block,n=e.children,o=e.defaultValue,c=e.values,b=Object(r.useState)(o),p=b[0],m=b[1],d=[];return a.a.createElement("div",null,a.a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:i()("tabs",{"tabs--block":t})},c.map((function(e){var t=e.value,n=e.label;return a.a.createElement("li",{role:"tab",tabIndex:"0","aria-selected":p===t,className:i()("tab-item",s.a.tabItem,{"tab-item--active":p===t}),key:t,ref:function(e){return d.push(e)},onKeyDown:function(e){return function(e,t,n){switch(n.keyCode){case u:!function(e,t){var n=e.indexOf(t)+1;e[n]?e[n].focus():e[0].focus()}(e,t);break;case l:!function(e,t){var n=e.indexOf(t)-1;e[n]?e[n].focus():e[e.length-1].focus()}(e,t)}}(d,e.target,e)},onFocus:function(){return m(t)},onClick:function(){return m(t)}},n)}))),a.a.createElement("div",{role:"tabpanel",className:"margin-vert--md"},r.Children.toArray(n).filter((function(e){return e.props.value===p}))[0]))}},278:function(e,t,n){"use strict";var r=n(0),a=n.n(r);t.a=function(e){return a.a.createElement("div",null,e.children)}}}]);